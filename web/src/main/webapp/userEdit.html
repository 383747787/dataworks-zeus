<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="stylesheets/mini.css" rel="stylesheet" type="text/css" />
<script src="js/boot.js" type="text/javascript" charset="UTF-8"></script>
<style type="text/css">
    html, body
    {
        font-size: 12px;
        padding: 0;
        margin: 0;
        border: 0;
        height: 100%;
        overflow: hidden;
    }
</style>
<title>修改用户信息</title>
</head>
<body>    
     
    <form id="form1" method="post">
        <input id="id" name="id" class="mini-hidden" />
        <div style="padding-left:11px;padding-bottom: 5px;">
            <table style="table-layout:fixed; line-height:30px;text-align:left;margin-left:15px;">
            	<tr>
	            	<td style="width:70px">用户类型：</td>
	                <td style="width:250px">
	                    <input id="userType" name="userType" class="mini-combobox" style="width:200px;" required="true"  url="data/userType.txt" value="0"/>
	                </td>
	                <td style="visibility:hidden">用户状态：</td>
	                <td>
	                    <input id="isEffective" name="isEffective" class="mini-combobox" style="width:200px; visibility:hidden" required="true"  url="data/isEffective.txt" value="0"/>
	                </td>
       			</tr>
                <tr>
                    <td>用户帐号：</td>
                    <td>    
                        <input id="uid" name="uid" class="mini-textbox"  style="width:200px;" required="true"/>
                    </td>
                    <td>用户姓名：</td>
                    <td>    
                        <input name="name" class="mini-textbox" style="width:200px;" required="true"/>
                    </td>
                </tr>
                <tr>
                    <td >邮箱地址：</td>
                    <td  colspan="3">    
                        <input name="email" class="mini-textarea" style="width: 520px; height: 100px;" required="true" />
                    </td>
                </tr>
                <tr>
                    <td >手机号码：</td>
                    <td  colspan="3">    
                        <input name="phone" class="mini-textarea" style="width: 520px; height: 100px;" required="true" />
                    </td>
                </tr>
                <tr>
	                <td>描述：</td>
	                <td colspan="3">
	                    <input name="description" class="mini-textarea" style="width: 520px; height: 110px;" required="false" />
	                </td>
            	</tr>
            	
            </table>
        </div>

        </br>
        <div style="text-align:center;padding:10px;">               
            <a class="mini-button" onclick="onOk" style="width:60px;margin-right:20px;">确定</a>       
            <a class="mini-button" onclick="onCancel" style="width:60px;">取消</a>       
        </div>        
    </form>
<script type="text/javascript">
    mini.parse();

    var form = new mini.Form("form1");
    var id = mini.get("id");
    var userType = mini.get("userType");
    var uid = mini.get("uid");
	
    function SaveData() {
        var o = form.getData();

        form.validate();
        if (form.isValid() == false) return;
        var json = mini.encode([o]);
        
        //console.log(id);
        
        if(id.value == ""){
	        $.ajax({
	            url: "../zeus-web/user.do?action=add",
	            type: "post",
	            data: { data: json },
	            cache: false,
	            success: function (text) {
	            	if(text=="error"){
	                    alert("此帐号已存在，请重新输入！");
	                }else{
	                    CloseWindow("save");
	                }
	            },
	            error: function (jqXHR, textStatus, errorThrown) {
	                //alert(jqXHR.responseText);
	                alert("添加失败，请重新输入！");
	                CloseWindow();
	            }
	        });
        }else{
	        $.ajax({
	            url: "../zeus-web/user.do?action=edit",
	            type: "post",
	            data: { data: json },
	            cache: false,
	            success: function (text) {
	            	CloseWindow("save");
	            },
	            error: function (jqXHR, textStatus, errorThrown) {
	                //alert(jqXHR.responseText);
	                alert("修改失败，请重新输入！");
	                CloseWindow();
	            }
	        });
        }
    }
    ////////////////////
    //标准方法接口定义
    function SetData(data) {
        if (data.action == "edit") {
            //跨页面传递的数据对象，克隆后才可以安全使用
            data = mini.clone(data);
            $.ajax({
                url: "../zeus-web/user.do?action=get&uid=" + data.uid,
                cache: false,
                success: function (text) {
                    var o = mini.decode(text);
                    //console.log(id);
                    id.value=o.value;
                    uid.readOnly = true;
                    userType.readOnly = true;
                    form.setData(o);
                    form.setChanged(false);
                }
            });
        }
    }

    function GetData() {
        var o = form.getData();
        return o;
    }
    
    function CloseWindow(action) {
        if (action == "close" && form.isChanged()) {
            mini.confirm("数据被修改了，是否先保存？", "确认", function (action) {
                if (action == "ok") {
                    return false;
                }
            });
        }
        if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
        else window.close();
    }
    
    function onOk(e) {
        SaveData();
    }
    
    function onCancel(e) {
        CloseWindow("cancel");
    }

    //屏蔽弹出框
    var WinAlerts = window.alert;
    window.alert = function (e) {
        if (e != null && e.indexOf("提示内容")>-1)
        {
            //和谐了
        }
        else
        {
            WinAlerts (e);
        }
        
    }; 
</script>
</body>
</html>
